<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Ticket Booking</title>
    <style>
        /* আগের CSS এখানেই থাকবে */
    </style>
</head>
<body>
    <div class="container">
        <div class="driver">Driver</div>
        <div class="entry">Entry</div>
        <h1>Bus Ticket Booking</h1>
        <div class="seats" id="seatContainer"></div>
        <div class="info">
            <p>Selected Seats: <span id="selectedSeats">0</span></p>
        </div>
        <div class="form" id="passengerForm">
            <h3>Passenger Information</h3>
            <input type="text" id="name" placeholder="Name" required>
            <input type="text" id="address" placeholder="Address" required>
            <input type="text" id="phone" placeholder="Phone Number" required>
            <input type="email" id="email" placeholder="Email" required>
            <button onclick="savePassengerInfo()">Save</button>
        </div>
    </div>

    <script>
        const seatContainer = document.getElementById('seatContainer');
        const selectedSeatsText = document.getElementById('selectedSeats');
        const passengerForm = document.getElementById('passengerForm');
        const nameInput = document.getElementById('name');
        const addressInput = document.getElementById('address');
        const phoneInput = document.getElementById('phone');
        const emailInput = document.getElementById('email');

        const googleScriptURL = "<আপনার Web App URL এখানে পেস্ট করুন>";
        let selectedSeats = [];
        let occupiedSeats = [];

        // Fetch already occupied seats from Google Sheets
        async function fetchOccupiedSeats() {
            const response = await fetch(googleScriptURL);
            const data = await response.json();
            occupiedSeats = data.map(entry => entry.Seat);
            renderSeats();
        }

        // Generate 40 seats dynamically
        function renderSeats() {
            seatContainer.innerHTML = '';
            const rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
            const cols = ['1', '2', '3', '4'];

            rows.forEach(row => {
                cols.forEach(col => {
                    const seat = document.createElement('div');
                    seat.classList.add('seat');
                    seat.textContent = `${row}${col}`;

                    if (occupiedSeats.includes(seat.textContent)) {
                        seat.classList.add('occupied');
                    }

                    seat.addEventListener('click', () => {
                        if (seat.classList.contains('occupied')) {
                            alert('This seat is already occupied!');
                            return;
                        }

                        if (seat.classList.contains('selected')) {
                            seat.classList.remove('selected');
                            selectedSeats = selectedSeats.filter(s => s !== seat.textContent);
                        } else {
                            seat.classList.add('selected');
                            selectedSeats.push(seat.textContent);
                        }

                        selectedSeatsText.textContent = selectedSeats.join(', ');
                        passengerForm.style.display = selectedSeats.length > 0 ? 'block' : 'none';
                    });

                    seatContainer.appendChild(seat);
                });
            });
        }

        // Save passenger information and update Google Sheet
        async function savePassengerInfo() {
            if (selectedSeats.length > 0) {
                const name = nameInput.value;
                const address = addressInput.value;
                const phone = phoneInput.value;
                const email = emailInput.value;

                if (name && address && phone && email) {
                    for (const seat of selectedSeats) {
                        const data = { seat, name, address, phone, email };

                        await fetch(googleScriptURL, {
                            method: 'POST',
                            body: JSON.stringify(data),
                            headers: { 'Content-Type': 'application/json' }
                        });

                        occupiedSeats.push(seat);
                    }

                    alert('Booking successful!');
                    selectedSeats = [];
                    nameInput.value = '';
                    addressInput.value = '';
                    phoneInput.value = '';
                    emailInput.value = '';
                    selectedSeatsText.textContent = '0';
                    passengerForm.style.display = 'none';

                    renderSeats(); // Update seat display
                } else {
                    alert('Please fill out all fields.');
                }
            }
        }

        // Initialize seats on page load
        fetchOccupiedSeats();
    </script>
</body>
</html>
